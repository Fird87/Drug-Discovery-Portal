<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     			xmlns:f="http://java.sun.com/jsf/core"
      			xmlns:ui="http://java.sun.com/jsf/facelets"
       			xmlns:h="http://java.sun.com/jsf/html"
      			xmlns:a4j="http://richfaces.org/a4j"
      		 	xmlns:rich="http://richfaces.org/rich">

    <f:view>
        <h:head>
<link rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/resources/css/style.css" type="text/css"/>
  
        </h:head>
        <h:body>
         <fieldset style="width: 90%;">
           		<legend>TPP</legend>
           			<h:form id="tppForm">
           				 <rich:messages id="message" ajaxRendered="true"></rich:messages>
               		  <h:panelGrid columns="6">
               		 
               		 
               		
           		  			    <h:outputText value="Name: " styleClass="font"/>
		               <h:inputText id="name" value="#{tpp.tpp_name}" required="true" requiredMessage="You need to insert name"  >
		                  <f:validateLength minimum="1" maximum="50" />
		                   <f:ajax event="blur" render="message"/>
		        		</h:inputText>
		        		
		        	 <h:outputText value="Effect: " styleClass="font"/>
		               <h:inputText id="effect" value="#{tpp.desired_effect}" required="true" requiredMessage="You need to insert effect"  >
		                  <f:validateLength minimum="1" maximum="50" />
		                   <f:ajax event="blur" render="message"/>
		        		</h:inputText>
		        		
		        		 <h:outputText value="Market target description: " styleClass="font"/>
		               <h:inputText id="desc" value="#{tpp.market_target_description}" required="true" requiredMessage="You need to insert description"  >
		                  <f:validateLength minimum="1" maximum="50" />
		                   <f:ajax event="blur" render="message"/>
		        		</h:inputText>
		        	
		        	 <h:outputText value="Incidence: " styleClass="font"/>
		               <h:inputText id="incidence" value="#{tpp.global_incidence}" required="true" requiredMessage="You need to insert global incidence"  validatorMessage="You need to insert global incidence"
		               onfocus="{this.value = ''; }" converter="javax.faces.Integer" converterMessage="Please enter numeric only">
		                 <f:validateDoubleRange for="incidence" minimum="0.01"/>
		                   <f:ajax event="blur" render="message"/>
		        		</h:inputText>
		        		  <h:outputText value="Prevalance: " styleClass="font"  />
		               <h:inputText id="prevalance" value="#{tpp.global_prevalence}" required="true" requiredMessage="You need to insert global prevalence"  validatorMessage="You need to insert global prevalence"
		                onfocus="{this.value = ''; }" converter="javax.faces.Integer" converterMessage="Please enter numeric only">
		                  <f:validateDoubleRange for="prevalance" minimum="0.01"/>
		                   <f:ajax event="blur" render="message"/>
		        		</h:inputText>
		        		
		        		<h:outputText value="Target condition: " styleClass="font" />
		               <h:inputText id="target" value="#{tpp.target_condition}" required="true" requiredMessage="You need to insert target"  >
		                  <f:validateLength minimum="1" maximum="50" />
		                   <f:ajax event="blur" render="message"/>
		        		</h:inputText>
		        		
		        	
		                 	</h:panelGrid>
		                 	
		                 <a href="#" onclick="#{rich:component('tppPanel')}.show()">Add multiple approved therapy</a>
		        		 <h:panelGroup style="display:block; text-align:center">
		                       <h:commandButton value="Save" action="#{tppAction.update()}" />
		                       
		                    
		                <h:commandButton value="Reset" type="reset" />
		                   </h:panelGroup>
           			<h:outputText value="&#160;" />
           			     <a4j:outputPanel id="tppDetail" ajaxRendered="true">
           			   
           			 <div style="height:150px ; width:100%; overflow-x:scroll; overflow-y:auto"> 
           			<rich:dataTable id="tpp_data" rows="10" value="#{tppAction.tppOnly}"
						var="tppDetail" >
           			<f:facet name="header">
                <rich:columnGroup>
						<rich:column sortable="true" sortBy="#{tppDetail.tppName}">
						<h:outputText value="Name" />
						</rich:column>
						<rich:column>
						<h:outputText value="ApprovedTherapy" />
						</rich:column>
						<rich:column>
							<h:outputText value="WorldRegion" />
						</rich:column>
						<rich:column>
							<h:outputText value="Company" />
						</rich:column>
						<rich:column>
							<h:outputText value="SideEffect" />
						</rich:column>
						<rich:column>
							<h:outputText value="TherapyAdmin" />
						</rich:column>
						<rich:column>
							<h:outputText value="TargetCondition" />
						</rich:column>
						<rich:column>
							<h:outputText value="GlobalIncidence" />
						</rich:column>
						<rich:column>
							<h:outputText value="GlobalPrevalence" />
						</rich:column>
						<rich:column>
							<h:outputText value="DesiredEffect" />
						</rich:column>
						<rich:column>
							<h:outputText value="MarketDescription" />
						</rich:column>
						</rich:columnGroup>
						</f:facet>
						<rich:column colspan="11" >
                <rich:collapsibleSubTableToggler for="sbtbltpp" />
               <h:outputText value=" #{tppDetail.tppName}" />
            </rich:column>
			<rich:collapsibleSubTable value="#{tppAction.getAllTpp(tppDetail.tppName)}" var="tppSubDetail" id="sbtbltpp" expandMode="client" expanded="'#{false}" >
                <rich:column>
               
                </rich:column>
                <rich:column>
                <h:outputText value=" #{tppSubDetail.appName}" />
                </rich:column>
                <rich:column>
                     <h:outputText value=" #{tppSubDetail.worldRegionName}" />
                </rich:column>
                <rich:column>
                 <h:outputText value=" #{tppSubDetail.companyName}" />
                </rich:column>
                 <rich:column>
                 <h:outputText value=" #{tppSubDetail.sideEffectName}" />
                </rich:column>
                 <rich:column>
                 <h:outputText value=" #{tppSubDetail.therapyAdminName}" />
                </rich:column>
                 <rich:column>
                 <h:outputText value=" #{tppSubDetail.targetCondition}" />
                </rich:column>
                 <rich:column>
                 <h:outputText value=" #{tppSubDetail.globalIncidence}" />
                </rich:column>
                 <rich:column>
                 <h:outputText value=" #{tppSubDetail.globalPrevalence}" />
                </rich:column>
                 <rich:column>
                 <h:outputText value=" #{tppSubDetail.desiredEffect}" />
                </rich:column>
                 <rich:column>
                 <h:outputText value=" #{tppSubDetail.marketTargetDescription}" />
                </rich:column>
            </rich:collapsibleSubTable>
            
						</rich:dataTable>
                 	<rich:dataScroller for="tpp_data" maxPages="10"
						styleClass="pagination-center" />
						</div>
				</a4j:outputPanel>
	
		   
		    	 		
		<rich:popupPanel id="tppPanel" autosized="true" height="200" width="800" top="400" domElementAttachment="form" show="#{tppAction.success}" >
			 <f:facet name="header">Add Multiple Approved Therapy</f:facet>
		<f:facet name="controls">
<h:outputLink value="#" style="font-size:large; color:black; textdecoration:
none;" onclick="#{rich:component('tppPanel')}.hide();return false;">
<h:graphicImage value="/resources/images/close-button.gif" />
</h:outputLink>
</f:facet>
		        
		                	<rich:dataTable id="tpp_datatable" rows="10" value="#{tppAction.getListOfObjects()}" var="lo"
						 columnClasses="col" >
						
						 <rich:column>
						<h:outputLabel value="Comparator"></h:outputLabel>
						<h:selectOneMenu  id="comparator" value="#{approved_therapy.approved_therapy_id}" required="true" requiredMessage="You need to select comparator" >
		        		<f:selectItem itemLabel="Choose" />
               <f:selectItems  value="#{tppAction.allAppTherapy}" var="t"
   			itemLabel="#{t.approved_therapy_name}" itemValue="#{t.approved_therapy_id}" />
   			<f:ajax event="change"  execute="@this"
								listener="#{tppAction.getTppApprovedTherapyId}" />
   		    </h:selectOneMenu>
   		   
						</rich:column>
						<rich:column>
							<h:outputLabel value="Competitors"></h:outputLabel><br/>
						<h:selectOneMenu  id="company" value="#{company.company_id}"  required="true" requiredMessage="You need to select competitors" >
		        		<f:selectItem itemLabel="Choose"  />
               <f:selectItems  value="#{tppAction.allCompany}" var="cy"
   			itemLabel="#{cy.company_name}" itemValue="#{cy.company_id}" />
   			<f:ajax event="change"  execute="@this"
								listener="#{tppAction.getCompanyId}" />
   		    </h:selectOneMenu>
   		  
						</rich:column>
						<rich:column>
						<h:outputLabel value="Admin"></h:outputLabel><br/>
						<h:selectOneMenu  id="admin"  value="#{therapy_administration.thearapy_administration_id}"  required="true" requiredMessage="You need to select admin">
				<f:selectItem itemLabel="Choose"  />
               <f:selectItems  value="#{tppAction.allTherapy_Adminstration}" var="t"
   			itemLabel="#{t.therapy_administration_name}" itemValue="#{t.thearapy_administration_id}" />
   			<f:ajax event="change" execute="@this"
								listener="#{tppAction.getTppTherapyAdminId}" />
   		    </h:selectOneMenu>
   		 
						</rich:column>
						<rich:column>
						<h:outputLabel value="Side effect tolerance"></h:outputLabel><br/>
						<h:selectOneMenu  id="tolerance"  value="#{side_effect_tolerance.side_effect_tolerance_id}"  required="true" requiredMessage="You need to select side effect tolerance" >
				<f:selectItem itemLabel="Choose"  />
               <f:selectItems  value="#{tppAction.allTolerance}" var="t"
   			itemLabel="#{t.side_effect_tolerance_name}" itemValue="#{t.side_effect_tolerance_id}" />
   			<f:ajax event="change" execute="@this"
								listener="#{tppAction.getTppSideEffectToleranceId}" />
   		    </h:selectOneMenu>
   		 
						</rich:column>
						<rich:column width="80px">
						<h:outputLabel value="Market"></h:outputLabel><br/>
						  <h:selectManyListbox label="Market" id="market" value="#{tppAction.world_regionsList}" required="true" requiredMessage="You need to select markets" >
					
						<f:selectItems value="#{tppAction.allWorldRegions}" var="m" itemLabel="#{m.worldRegionsName}" itemValue="#{m.worldRegionsId}"></f:selectItems>
			</h:selectManyListbox>
           		
   		
						</rich:column>
						<rich:column>
						<h:panelGroup >
					  <h:commandButton  action="#{tppAction.add(approved_therapy.approved_therapy_id)}" image="/resources/images/add.gif" reRender="tpp_datatable" title="Add new line" >
		                      
		                       </h:commandButton>
		                       <h:commandButton    action="#{tppAction.remove()}"  image="/resources/images/delete.gif" reRender="tpp_datatable" title="remove">
		                       </h:commandButton>
		                       </h:panelGroup>
		              </rich:column>
						 </rich:dataTable>
				
				<center><h:commandButton value="Return" onclick="#{rich:component('tppPanel')}.hide();return false;"/></center>



		</rich:popupPanel>
 </h:form>
          </fieldset>
        </h:body>
        </f:view>
        </ui:composition>